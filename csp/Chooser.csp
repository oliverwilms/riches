<html>
<head>
<script language="Cache" runat="Server">
Set tHeader = "Riches - Chooser"
If ($Data(%request.Data("iChoose",1))) {
	Set iChoose = %request.Data("iChoose",1)
	Set tHeader = "Riches - "_iChoose_" Chooser"
}
Set tChoose = $ZCONVERT($Get(iChoose),"U")
Do ##class(Riches.Util).DebugTEST("<head> tChoose = "_tChoose)
If (tChoose = "ACCOUNT") {
	Merge pRequestData = %request.Data
	Set tSC = ##class(Riches.Account).SubmitFormData(.pRequestData,.pAction,.pId)
}
If (tChoose = "CATEGORY") {
	Merge pRequestData = %request.Data
	Set tSC = ##class(Riches.Category).SubmitFormData(.pRequestData,.pAction,.pId)
}
Set tAction = $ZCONVERT($Get(pAction),"U")
Do ##class(Riches.Util).DebugTEST("<head> tAction = "_tAction)
If (tAction = "ADD") {
	If (tChoose = "ACCOUNT") {
		Set tElementId = "iAccount"
	}
	If (tChoose = "CATEGORY") {
		Set tElementId = "iCategory"
	}
}
</script>
<script language="JavaScript">
function onloadHandler()
{
	var tAction = '#($Get(tAction,""))#';
	var tElementId = '#($Get(tElementId,""))#';
	var tId = '#($Get(pId,""))#';
	if (tAction != '') {
		parent.document.getElementById(tElementId).value = tId;
	}
}
</script>
<title>#(tHeader)#</title>
</head>
<body onload="onloadHandler();">
<h2>#(tHeader)#</h2>
<form>
<script language="Cache" runat="Server">
Do ##class(Riches.Util).DebugTEST("<form> tChoose = "_tChoose)
If (tChoose = "ACCOUNT") { Set tClassname = "Riches.Account" }
If (tChoose = "CATEGORY") { Set tClassname = "Riches.Category" }
If (tChoose = "MERCHANT") {	Set tClassname = "Riches.Merchant" }
If ($Get(tClassname) '= "") Set tSC = $CLASSMETHOD(tClassname,"OutputFormData")
</script>
</form>

<script language="Cache" runat="Server">
Write "<table>",!
If (tChoose = "ACCOUNT") { Set tClassname = "Riches.Account" }
If (tChoose = "CATEGORY") { Set tClassname = "Riches.Category" }
If (tChoose = "MERCHANT") {	Set tClassname = "Riches.Merchant" }
If ($Get(tClassname) '= "") Set tSC = $CLASSMETHOD(tClassname,"OutputTableData")
Write "</table>",!
/*
Write "<textarea id='debug' name='debug' rows='5' cols='50'>",!
Set tDebug = ""
Set tRow = ""
For {
	If ($Data(^TESTunit) = 0) { Quit }
	Set tDebug = $Order(^TESTunit(tDebug))
	If (tDebug = "") { Quit }
	Write $Get(^TESTunit(tDebug)),!
	If ($Increment(tRow) > 4) { Quit }
}
Write "</textarea>","<br>",!
Write "<a href='/csp/sys/exp/UtilExpGlobalView.csp?$ID2=TESTunit&$NAMESPACE=",$Namespace,"'>View Debug Global</a>"
*/
</script>

</body>
</html>
