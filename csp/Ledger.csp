<html>
<head>
<script language="Cache" runat="Server">
Set tHeader = "Riches - Ledger"
If ($Data(%request.Data("iAccount",1))) {
	Set iAccount = %request.Data("iAccount",1)
	Set objAccount = ##class(Riches.Account).%OpenId(iAccount)
	If $IsObject(objAccount) Set tNickname = objAccount.Nickname
	Set tHeader = "Riches - "_tNickname_" Ledger"
}
Set tChoose = $ZCONVERT($Get(iChoose),"U")
Do ##class(Riches.Util).DebugTEST("<head> tChoose = "_tChoose)
If (tChoose = "ACCOUNT") {
	Set tClassname = "Riches.Account"
	Set tElement = "Account" 
}
If (tChoose = "CATEGORY") {
	Set tClassname = "Riches.Category"
	Set tElement = "Category"
}
If (tChoose = "MERCHANT") {
	Set tClassname = "Riches.Merchant"
	Set tElement = "Merchant"
}
If ($Get(tClassname) '= "") {
	Merge pRequestData = %request.Data
	Set tSC = $CLASSMETHOD(tClassname,"SubmitFormData",.pRequestData,.pAction,.pLogicalDisplay)
}
Set tAction = $ZCONVERT($Get(pAction),"U")
Do ##class(Riches.Util).DebugTEST("<head> tAction = "_tAction)
</script>
<script language="JavaScript">
function onloadHandler()
{
	var tAction = '#($Get(tAction,""))#';
	var tLogicalDisplay = '#($Get(pLogicalDisplay,""))#';
	if (tAction != '') {
		updateLogicalDisplay(tLogicalDisplay);
	}
}
function tableClickHandler(id)
{
	updateLogicalDisplay(id);
}
function updateLogicalDisplay(id)
{
	var delim = '^';
	var arr = id.split(delim);
	var tDisplay = 'd' + '#($Get(tElement,""))#';
	var tLogical = 'i' + '#($Get(tElement,""))#';
	parent.document.getElementById(tLogical).value = arr[1];
	parent.document.getElementById(tDisplay).value = arr[2];
}
</script>
<title>#(tHeader)#</title>
</head>
<body onload="onloadHandler();">
<h2>#(tHeader)#</h2>
<form>
<script language="Cache" runat="Server">
Do ##class(Riches.Util).DebugTEST("<form> tChoose = "_tChoose)
If (tChoose = "ACCOUNT") { Set tClassname = "Riches.Account" }
If (tChoose = "CATEGORY") { Set tClassname = "Riches.Category" }
If (tChoose = "MERCHANT") {	Set tClassname = "Riches.Merchant" }
If ($Get(tClassname) '= "") Set tSC = $CLASSMETHOD(tClassname,"OutputFormData")
</script>
</form>

<table>
<tr>
<td>Starting Balance</td>
<td>#(objAccount.StartBalance)#</td>
</tr>
<script language="Cache" runat="Server">
//Do ##class(Riches.Util).DebugTEST("<form> tChoose = "_tChoose)
If (tChoose = "ACCOUNT") { Set tClassname = "Riches.Account" }
If (tChoose = "CATEGORY") { Set tClassname = "Riches.Category" }
If (tChoose = "MERCHANT") {	Set tClassname = "Riches.Merchant" }
//If ($Get(tClassname) '= "") Set tSC = $CLASSMETHOD(tClassname,"OutputFormData")
Set tClassname = "Riches.Transact"
If ($Get(tClassname) '= "") {
	Set pWhere = ""
	Set pTrClick = "javascript:tableClickHandler('#');"
	Set pMaxRows = -1
	Set tSC = $CLASSMETHOD(tClassname,"OutputTableData",pWhere,pTrClick,pMaxRows)
}
</script>
</table>

<script language="Cache" runat="Server">
/*
Write "<table>",!
If (tChoose = "ACCOUNT") { Set tClassname = "Riches.Account" }
If (tChoose = "CATEGORY") { Set tClassname = "Riches.Category" }
If (tChoose = "MERCHANT") {	Set tClassname = "Riches.Merchant" }
If ($Get(tClassname) '= "") {
	Set pWhere = ""
	Set pTrClick = "javascript:tableClickHandler('#');"
	Set pMaxRows = -1
	Set tSC = $CLASSMETHOD(tClassname,"OutputTableData",pWhere,pTrClick,pMaxRows)
}
Write "</table>",!
Write "<textarea id='debug' name='debug' rows='5' cols='50'>",!
Set tDebug = ""
Set tRow = ""
For {
	If ($Data(^TESTunit) = 0) { Quit }
	Set tDebug = $Order(^TESTunit(tDebug))
	If (tDebug = "") { Quit }
	Write $Get(^TESTunit(tDebug)),!
	If ($Increment(tRow) > 4) { Quit }
}
Write "</textarea>","<br>",!
Write "<a href='/csp/sys/exp/UtilExpGlobalView.csp?$ID2=TESTunit&$NAMESPACE=",$Namespace,"'>View Debug Global</a>"
*/
</script>

</body>
</html>
